# Template file for 'awesome-LuaJIT'
pkgname=awesome-LuaJIT
version=4.3
revision=1
wrksrc="awesome-${version}"
build_style=cmake
build_helper="qemu"
configure_args="
 -DSYSCONFDIR=/etc
 -DLUA_LIBRARY=/usr/lib/libluajit-5.1.so.2.1.0"
conf_files="/etc/xdg/awesome/rc.lua"
hostmakedepends="ruby-asciidoctor ImageMagick lgi-LuaJIT LuaJIT pkg-config xmlto"
makedepends="libxcb-devel pango-devel xcb-util-devel xcb-util-image-devel
 xcb-util-keysyms-devel xcb-util-wm-devel xcb-util-cursor-devel
 startup-notification-devel imlib2-devel lgi-LuaJIT libxdg-basedir-devel
 gdk-pixbuf-devel lua51-devel LuaJIT-devel dbus-devel libxkbcommon-devel xcb-util-xrm-devel"
depends="dbus-x11 lgi-LuaJIT pango"
short_desc="Highly configurable, next gen framework window manager for X with LuaJIT"
maintainer="mustaqim <mustaqim@pm.me>"
license="GPL-2.0-or-later"
homepage="http://awesomewm.org"
distfiles="https://github.com/awesomeWM/awesome/releases/download/v${version}/awesome-${version}.tar.xz"
checksum=78264d6f012350b371e339127aca485260bc0aa935eff578ba75ce1a00e11753
conflicts="awesome"

pre_configure() {
	# Russian manpages fail to build.
	vsed -i -e "s|es fr de ru|es fr de|g" CMakeLists.txt

	vsed -i -e "s|COMMAND lua\b|COMMAND luajit|" awesomeConfig.cmake tests/examples/CMakeLists.txt
	vsed -i -e "s|LUA_COV_RUNNER lua\b|LUA_COV_RUNNER luajit|" tests/examples/CMakeLists.txt
}

post_install() {
	vinstall awesome.desktop 644 usr/share/xsessions
}
